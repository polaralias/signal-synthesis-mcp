# Deployment: Smithery & Docker

This document outlines how to configure the project for deployment on [Smithery](https://smithery.ai) and how to run it locally using Docker.

## Overview

The project is configured to support Smithery's "Container" runtime. This allows us to define a custom Docker environment that builds our TypeScript MCP server.

Two key files in the repository root manage this configuration:
1.  **`Dockerfile`**: Defines the build process for the server image.
2.  **`smithery.yaml`**: Defines the Smithery deployment configuration, including the runtime type and build settings.

## 1. Docker Configuration

We use a multi-stage Docker build to keep the final image size optimized. The build assumes a standard TypeScript project structure.

### `Dockerfile`

Create a `Dockerfile` in the root of the repository:

```dockerfile
# Generated by Smithery configuration
FROM node:18-alpine

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm install

# Copy application code
COPY . .

# Build the application
RUN npm run build

# Start the server
CMD ["node", "dist/index.js"]
```

> **Note**: Ensure your `package.json` has a `build` script (e.g., `tsc`) and that the output directory matches `dist/`.

## 2. Smithery Configuration

Smithery uses `smithery.yaml` to understand how to deploy the MCP server. We use the `container` runtime to leverage our Dockerfile.

### `smithery.yaml`

Create a `smithery.yaml` in the root of the repository:

```yaml
runtime: "container"

startCommand:
  type: "http"
  configSchema:
    type: "object"
    properties:
      # Add configuration properties exposed to the MCP client here
      # For example, API keys if they are passed via config instead of env vars
      apiKey:
        type: "string"
        description: "API Key for primary provider"
    required: []

build:
  dockerfile: "Dockerfile"
  dockerBuildPath: "."
```

## 3. Local Development & Testing

### Running with Docker Locally

You can build and run the server locally to ensure the Docker configuration is correct before deploying.

1.  **Build the image:**
    ```bash
    docker build -t financial-mcp-server .
    ```

2.  **Run the container:**
    ```bash
    docker run -p 3000:3000 --env-file .env financial-mcp-server
    ```
    *Note: Ensure you have a `.env` file with necessary API keys (ALPACA_API_KEY, etc.).*

### Deployment to Smithery

1.  Push your changes (including `Dockerfile` and `smithery.yaml`) to your GitHub repository.
2.  Import the repository in Smithery.
3.  Smithery will detect the configuration and deploy the server using the defined container build.

## 4. TypeScript Project Structure Requirements

To support this deployment, the TypeScript project should adhere to the following structure:

*   **Root**: `package.json`, `tsconfig.json`, `Dockerfile`, `smithery.yaml`.
*   **Source**: `src/` containing the TypeScript source code.
*   **Entry Point**: `src/index.ts` (which compiles to `dist/index.js`).
*   **Scripts**:
    *   `build`: Compiles TypeScript to JavaScript (e.g., `tsc`).
    *   `start`: Runs the compiled code (e.g., `node dist/index.js`).

## 5. Environment Variables

Environment variables defined in `.env` (like API keys) need to be provided to the container environment.
*   **Locally**: Use `--env-file .env` when running `docker run`.
*   **Smithery**: Configure environment variables in the Smithery dashboard settings for your project.
